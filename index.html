<!DOCTYPE html>
<html lang="en">
<head>
  <title>The Standard</title>
  <meta name="viewport" content="width=device-width, user-scalable=no" />
  <script src="shared.js"></script>
  <script src="scripts.js"></script>
  <script src="elements/device.js"></script>
  <script src="elements/scene.js"></script>
  <script src="elements/page.js"></script>
  <script src="elements/lines.js"></script>
  <style type="text/css">

html {
  background: #eaeaea;
  min-height: 100vh;
  font-family: 'Roboto', Sans-Serif;
}
body {
  margin: 0;
}

header {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  background: #ccc;
  padding: 8px;
}

ts-scene[disabled] {
  opacity: 0.25;
}

</style>
</head>
<body>

<header>
  <button id="type">Device</button>
  <button id="toggle">Toggle</button>
  <select id="videos">
    <option value="">▶︎ Showcase</option>
    <option value="TS003">Fit To Page</option>
    <option value="TS006">Align Content Vertically</option>
  </select>
</header>

<ts-scene id="scene" disabled>
  <ts-device device="tablet">
    <ts-page>
    </ts-page>
  </ts-device>
</ts-scene>

  <script>

const sceneInterval = 1000;

let interval;
const select = document.querySelector('select#videos');
select.addEventListener('change', ev => {
  window.clearInterval(interval);

  const scene = document.querySelector('ts-scene');
  const device = scene.querySelector('ts-device');
  const page = device.querySelector('ts-page');

  function reset() {
    page.class = '';
    scene.scene = null;
    device.overflow = false;
  }

  if (!select.value) {
    page.html = '';
    page.css = '';
    return reset();
  }

  const s = scripts[select.value];
  if (!s) {
    throw new Error('no script for: ' + select.value);
  }

  const result = {};

  const fetchHTML = window.fetch(`scripts/${select.value}.html`)
      .then(out => out.text())
      .then(v => { result.html = v; });

  const fetchCSS = window.fetch(`scripts/${select.value}.css`)
      .then(out => out.text())
      .then(v => { result.css = v; });

  Promise.all([fetchHTML, fetchCSS]).then(_ => {
    page.html = result.html;
    page.css = result.css;
  }).then(_ => {
    let i = -1;
    interval = window.setInterval(function() {
      if (i == -1) {
        reset();
        scene.removeAttribute('disabled');
      } else if (i == s.length) {
        scene.setAttribute('disabled', '');
        i = -1;
        return;
      } else {
        const frame = s[i];
        if (frame.class) { page.class = frame.class; }
        if ('scene' in frame) { scene.scene = frame.scene; }
        if ('overflow' in frame) { device.overflow = frame.overflow; }
      }

      console.info('frame', i);
      ++i;
    }, sceneInterval);
  });
});

const device = document.querySelector('ts-device');
document.querySelector('button#type').addEventListener('click', ev => device.stepDevice());

  var step = 0;

  toggle.addEventListener('click', function() {
    var html = document.querySelector('ts-page');
    var body = document.querySelector('.body');

    switch (++step) {
    case 1:
      html.classList.add('highlight');
      break;
    case 2:
      body.classList.add('height');
      break;
    case 3:
      body.classList.add('nomargin');
      break;
    case 4:
      html.classList.remove('highlight');
      break;
    case 5:
      scene.removeAttribute('scene');
      device.setAttribute('overflow', '');
      break;
    case 6:
      html.classList.add('scroll');
      break;
    case 7:
      html.classList.add('bgcolor');
      break;
    case 8:
      html.classList.remove('scroll');
      break;
    }


  });
  </script>

</body>
</html>